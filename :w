{ lib, writeShellScriptBin, ensure-user-is-root, iproute2, coreutils, gnugrep, nettools, gum }:

let
  paths = lib.makeBinPath [ ensure-user-is-root iproute2 coreutils gnugrep nettools gum ];
in

writeShellScriptBin "host-status" ''
    export PATH=${paths}
    set -efu -o pipefail
    msgs=()
    msgs+=("Network is up: $(if [ -n "$(ip -brief -color addr)" ]; then echo "yes"; else echo "no"; fi)")
    msgs+=("Local network addresses: $(ip -brief -color addr | grep -v "lo" | awk '{print $3}')")
    msgs+=("Multicast DNS: $(hostname).local")
    gum join --vertical "''${msgs[@]}"
''
